<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<!--
@license
Copyright (c) 2016 Hemant Jadon. All rights reserved.
-->

<!-- Polymer and PolymerElements -->
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-tooltip/paper-tooltip.html">

<!-- Custom Web Components -->

<dom-module id="blog-card">
  <template>
    <style include="iron-flex iron-flex-alignment">
      :host {
        display: block;
      }
      a{
        text-decoration: none;
      }
      .blog-container{
        width: 700px;
        min-height: 300px;
        margin: 20px 10px;
        border: 1px solid #e3e5e7;
        border-radius: 5px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.12);
        cursor: pointer;
      }
      .blog-container:hover .image-container{
        background: #f0f0f0;

      }
      .image-container{
        width: 150px;
        background: #fafafa;
        border-right: 1px solid #e3e5e7;
      }
      .image-container .image{
        width: 100px;
        height: 100px;
        border: 1px solid transparent;
        border-radius: 50%;
        background: white;
      }
      .text-container{
        width: 550px;
        padding: 30px 25px;
      }
      .text-container .blog-detail-container .blog-category{
        color: var(--secondary-text-color);
        font-weight: 300;
        font-size: 0.9em;
      }
      .text-container .blog-detail-container .blog-title h3{
        color: var(--primary-text-color);
        font-weight: 400;
        font-size: 1.8em;
        padding: 10px 0px;
        margin: 0;
      }
      .text-container .blog-detail-container .blog-description p{
        color: var(--secondary-text-color);
        font-weight: 300;
        font-size: 1em;
        line-height: 200%;
        padding: 10px 0px;
        margin: 0;
      }
      .text-container .blog-stat-info-container > span{
        font-size: 0.8rem;
        position: relative;
        width: 150px;
        text-align: center;
        color: var(--secondary-text-color);
      }
      .text-container .blog-stat-info-container .blog-social-info-container
      paper-icon-button{
        --paper-icon-button-ink-color	: var(--accent-color);
        cursor: auto;
      }
      .text-container .blog-stat-info-container .blog-social-info-container
      paper-icon-button.liked{
        color: var(--accent-color);
      }
      .text-container .blog-stat-info-container .blog-social-info-container
      paper-icon-button[disabled]{
        color: #f0f0f0;
      }

      /* Mobile Displays */
      @media(min-width: 361px) and (max-width: 767px){
        .blog-container{
          width: auto;
        }
        .image-container{
          height: 150px;
          width: 100%;
          border-right: none;
          border-bottom: 1px solid #e3e5e7;
        }
        .text-container{
          width: 80vw;
        }
        .text-container .blog-detail-container h3,p{
          text-align: center;
        }
      }

      /* Small Mobile Displays*/
      @media(max-width: 360px){
        .blog-container{
          width: auto;
        }
        .image-container{
          height: 150px;
          width: 100%;
          border-right: none;
          border-bottom: 1px solid #e3e5e7;
        }
        .text-container{
          width: 80vw;
        }
        .text-container .blog-detail-container h3,p{
          text-align: center;
        }
        .text-container .blog-stat-info-container > span{
          line-height: 200%;
        }
      }
    </style>

    <!-- iron-media-queries -->
    <iron-media-query
      query="(min-width: 768px)"
      query-matches="{{is_desktop}}"></iron-media-query>

    <iron-media-query
      query="(min-width: 361px) and (max-width: 767px)"
      query-matches="{{is_mobile}}"></iron-media-query>

    <iron-media-query
      query="(max-width: 360px)"
      query-matches="{{is_sm_mobile}}"></iron-media-query>

    <!--------->

    <a href="/blogs/read/{{blog.id}}" id="{{__getUniqueId('redirect_link',index)}}">
      <div class="blog-container layout horizontal" id="blog_container"> <!-- add vertical on small remove horizontal-->
        <div class="image-container layout vertical center around-justified">
          <div class="image">
            <!-- Image Place Holder -->
          </div>
        </div>
        <div class="text-container layout vertical justified">
          <div class="blog-detail-container layout vertical" id="blog_detail_container"><!-- add center on small -->
            <span class="blog-category">{{toUpperCase(blog.category)}}</span>
            <span class="blog-title"><h3>{{blog.title}}</h3></span>
            <span class="blog-description"><p>{{blog.description}}</p></span>
          </div>
          <div class="blog-stat-info-container layout horizontal justified center" id="blog_stat_info_container"><!-- add vertical on very-small -->
            <span class="blog-author layout horizontal start-justified center"
                  id="{{__getUniqueId('blog_author_description',index)}}" on-tap="prevent_redirect">
              <paper-icon-button class="blog-author-photo" icon="face"></paper-icon-button>
              <span>@{{blog.author_username}}</span>
              <paper-tooltip for="{{__getUniqueId('blog_author_description',index)}}" offset=0>Author</paper-tooltip>
            </span>
            <span class="blog-timestamp">{{momentify(blog.timestamp)}}</span>
            <span class="blog-social-info-container layout horizontal end-justified center" on-tap="prevent_redirect">
              <paper-icon-button id="{{__getUniqueId('blog_like_button',index)}}" icon="favorite"
                                class$="{{__getClassLiked(like)}}" on-tap="toggleLike">
              </paper-icon-button>
              <paper-tooltip for="{{__getUniqueId('blog_like_button',index)}}" offset=0>{{__getLikeTooltipText(like)}}</paper-tooltip>
              <span class="blog-like-count">1k</span>
            </span>
          </div>
        </div>
      </div>
    </a>
  </template>

  <!-- External Scripts -->
  <script type="text/javascript" src="../../bower_components/moment/moment.js"></script>

  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'blog-card',

      properties: {
        blog:{
          type : Object,
          notify : true
        },
        like:{
          type : Boolean,
          notify : true,
          value : false,
        },

        // iron-media-query properties
        is_desktop : {
          type : Boolean,
          observer : "media_query_observer_desktop"
        },
        is_mobile : {
          type : Boolean,
          observer : "media_query_observer_mobile"
        },
        is_sm_mobile : {
          type : Boolean,
          observer : "media_query_observer_sm_mobile"
        }
      },

      // Application Logic Methods
      toggleLike(evt){
        this.like = !this.like;
      },

      prevent_redirect(evt){
        evt.preventDefault();
      },

      // Media Query Observers
      media_query_observer_desktop(){
        let blog_container_class_list = Array.from(this.$.blog_container.classList);
        let blog_detail_container_class_list = Array.from(this.$.blog_detail_container.classList);
        let blog_stat_info_container_class_list = Array.from(this.$.blog_stat_info_container.classList);

        if (this.is_desktop) {
          // Handling blog_container
          if (blog_container_class_list.includes("horizontal")) {
            // Already Horizontaled
            return;
          }
          else{
            // Make Horizontaled
            if (blog_container_class_list.includes("vertical")) {
              this.$.blog_container.classList.remove("vertical");
            }
            this.$.blog_container.classList.add("horizontal");
          }

          // Handling blog_detail_container
          if (!blog_detail_container_class_list.includes("center")) {
            // Already Left Aligned
            return;
          }
          else{
            // Make Left Aligned
            this.$.blog_detail_container.classList.remove("center");
          }
        }
      },
      media_query_observer_mobile(){
        let blog_container_class_list = Array.from(this.$.blog_container.classList);
        let blog_detail_container_class_list = Array.from(this.$.blog_detail_container.classList);
        let blog_stat_info_container_class_list = Array.from(this.$.blog_stat_info_container.classList);

        if (this.is_mobile) {
          // Handling blog_container
          if (blog_container_class_list.includes("vertical")) {
            // Already vertical
            return;
          }
          else{
            // Make vertical
            if (blog_container_class_list.includes("horizontal")) {
              this.$.blog_container.classList.remove("horizontal");
            }
            else{
              this.$.blog_container.classList.add("vertical");
            }
          }

          // Handling blog_detail_container
          if (blog_detail_container_class_list.includes("center")) {
            // Already Centered
            return;
          }
          else{
            // Make Centered
            this.$.blog_detail_container.classList.add("center");
          }
        }
      },
      media_query_observer_sm_mobile(){
        let blog_container_class_list = Array.from(this.$.blog_container.classList);
        let blog_detail_container_class_list = Array.from(this.$.blog_detail_container.classList);
        let blog_stat_info_container_class_list = Array.from(this.$.blog_stat_info_container.classList);

        if (this.is_sm_mobile) {
          // Handling blog_container
          if (blog_container_class_list.includes("vertical")) {
            // Already vertical
            return;
          }
          else {
            // Make vertical
            if (blog_container_class_list.includes("horizontal")) {
              this.$.blog_container.classList.remove("horizontal");
            }
            else{
              this.$.blog_container.classList.add("vertical");
            }
          }

          // Handling blog_detail_container
          if (blog_detail_container_class_list.includes("center")) {
            // Already Centered
            return;
          }
          else {
            // Make Centered
            this.$.blog_detail_container.classList.add("center");
          }
        }
      },


      // Auxilary computing methods
      toUpperCase(str){
        return str.toUpperCase();
      },
      momentify(DateTime_String){
        let _moment = moment(DateTime_String,moment.ISO_8601);

		    return _moment.format("MMMM DD[,] YYYY");
      },
      __getUniqueId(prefix_string,index){
        return `${prefix_string}_${index}`;
      },
      __getLikeTooltipText(like){
        if (like) {
          return "Liked !!";
        }
        else {
          return "Like !";
        }
      },

      // __getClass Methods
      __getClassLiked(like){
        if (like) {
          return "liked";
        }
        else {
          return "";
        }
      }
    });
  })();
  </script>
</dom-module>
